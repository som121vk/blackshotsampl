<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Checkout | Blackshot Toy Store</title>
    <link rel="stylesheet" href="css/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>

<body>

    <!-- Header -->
    <header>
        <div class="container nav-wrapper">
            <div class="logo">
                <a href="index.html" style="text-decoration: none; color: inherit;">
                    <i class="fas fa-rocket"></i> BLACKSHOT
                </a>
            </div>
            <nav class="nav-links">
                <a href="index.html">Home</a>
                <a href="cart.html">Cart</a>
            </nav>
        </div>
    </header>

    <!-- Checkout Content -->
    <section class="container">
        <h2 style="margin: 30px 0 20px 0;">Checkout</h2>

        <div class="checkout-container">
            <div class="checkout-form">
                <form id="checkout-form">
                    <!-- Contact Information -->
                    <div class="checkout-section">
                        <h3>Contact Information</h3>
                        <div class="form-group">
                            <label>Email</label>
                            <input type="email" id="email" required placeholder="your@email.com">
                        </div>
                        <div class="form-group">
                            <label>Phone Number</label>
                            <input type="tel" id="phone" required placeholder="+91 XXXXX XXXXX">
                        </div>
                    </div>

                    <!-- Shipping Address -->
                    <div class="checkout-section">
                        <h3>Shipping Address</h3>
                        <div class="form-group">
                            <label>Full Name</label>
                            <input type="text" id="fullname" required placeholder="John Doe">
                        </div>
                        <div class="form-group">
                            <label>Address</label>
                            <input type="text" id="address" required placeholder="Street Address">
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>City</label>
                                <input type="text" id="city" required placeholder="City">
                            </div>
                            <div class="form-group">
                                <label>State</label>
                                <input type="text" id="state" required placeholder="State">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>PIN Code</label>
                                <input type="text" id="pincode" required placeholder="400001">
                            </div>
                            <div class="form-group">
                                <label>Country</label>
                                <input type="text" id="country" value="India" required>
                            </div>
                        </div>
                    </div>

                    <!-- Billing Address -->
                    <div class="checkout-section">
                        <h3>Billing Address</h3>
                        <div class="checkbox-group">
                            <input type="checkbox" id="same-address" checked>
                            <label for="same-address">Same as shipping address</label>
                        </div>
                    </div>

                    <button type="submit" class="btn btn-primary" style="width: 100%; padding: 15px;">
                        Continue to Payment
                    </button>
                </form>
            </div>

            <!-- Order Summary -->
            <div class="order-summary">
                <h3 style="margin-bottom: 20px;">Order Summary</h3>
                <div id="order-items">
                    <!-- Items will be rendered here -->
                </div>
                <div class="summary-row" style="margin-top: 20px;">
                    <span>Subtotal</span>
                    <span id="subtotal">₹0</span>
                </div>
                <div class="summary-row">
                    <span>Shipping</span>
                    <span>FREE</span>
                </div>
                <div class="summary-row total">
                    <span>Total</span>
                    <span id="total">₹0</span>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer>
        <div class="container footer-content">
            <div class="footer-col">
                <h3>BLACKSHOT</h3>
                <p>Premium toy store for the modern family.</p>
            </div>
        </div>
    </footer>

    <script src="js/store.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // 1. Check Login Status
            const currentUser = Store.getCurrentUser();
            if (!currentUser) {
                alert('You must be logged in to checkout.');
                window.location.href = 'login.html?redirect=checkout.html';
                return;
            }

            // 2. Prefill user info if available
            if (document.getElementById('email')) document.getElementById('email').value = currentUser.email;
            if (document.getElementById('fullname')) document.getElementById('fullname').value = currentUser.name;

            const cart = Store.getCart();

            // Redirect if cart is empty
            if (cart.length === 0) {
                alert('Your cart is empty!');
                window.location.href = 'index.html';
                return;
            }

            renderOrderSummary();
        });

        function renderOrderSummary() {
            const cart = Store.getCart();
            const orderItems = document.getElementById('order-items');

            orderItems.innerHTML = cart.map(item => `
                <div class="order-item">
                    <span class="order-item-name">${item.name}</span>
                    <span class="order-item-qty">x${item.quantity}</span>
                    <span>${Store.formatPrice(item.price * item.quantity)}</span>
                </div>
            `).join('');

            const total = Store.getCartTotal();
            document.getElementById('subtotal').textContent = Store.formatPrice(total);
            document.getElementById('total').textContent = Store.formatPrice(total);
        }

        document.getElementById('checkout-form').addEventListener('submit', (e) => {
            e.preventDefault();

            // Save shipping info to localStorage
            const shippingInfo = {
                email: document.getElementById('email').value,
                phone: document.getElementById('phone').value,
                fullname: document.getElementById('fullname').value,
                address: document.getElementById('address').value,
                city: document.getElementById('city').value,
                state: document.getElementById('state').value,
                pincode: document.getElementById('pincode').value,
                country: document.getElementById('country').value
            };

            localStorage.setItem('shipping_info', JSON.stringify(shippingInfo));
            window.location.href = 'payment.html';
        });
    </script>
</body>

</html>